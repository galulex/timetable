%h1= @schedule.title

= link_to 'Manage Teachers', schedule_teachers_path(@schedule)
= link_to '+', new_schedule_teacher_path(@schedule), :rel => :lazybox
= link_to 'Manage Audiences', schedule_audiences_path(@schedule)
= link_to '+', new_schedule_audience_path(@schedule), :rel => :lazybox
= link_to 'Manage Groups', schedule_groups_path(@schedule)
= link_to '+', new_schedule_group_path(@schedule), :rel => :lazybox
= link_to 'Manage Schedule Calls', schedule_schedule_calls_path(@schedule)
= link_to '+', new_schedule_schedule_call_path(@schedule), :rel => :lazybox
= link_to schedule_action, schedule_path(@schedule), :method => :put
%br
= link_to 'All', schedule_path(@schedule)
- @schedule.days.each_pair do |i, day|
  = link_to day, schedule_path(@schedule, :day_id => i)

- if @schedule.groups.any?
  %table
    %thead
      %tr
        %th{ :colspan => 2 }
        - @schedule.groups.each do |group|
          %th{:id => "group_#{group.id}"}= group.name
        %th.new_group= link_to '+', new_schedule_group_path(@schedule), :rel => :lazybox
    %tbody
      - @days.each_pair do |i, day|
        %tr
          %th{ :rowspan => @schedule.schedule_calls.size + 1 }= day
        - @schedule.schedule_calls.each do |call|

          %tr
            %th= call.time
            - @schedule.groups.each do |group|
              %td
                - if lesson = @lessons.find_by_group_id_and_day_id_and_schedule_call_id(group.id, i, call.id)
                  = render :partial => 'lesson', :object => lesson
                - else
                  = link_to('+', new_schedule_lesson_path(@schedule, :group_id => group.id, :day_id => i, :schedule_call_id => call.id), :rel => :lazybox, :class => 'add_lesson_link')
                  = link_to('paste', paste_schedule_lesson_path(@schedule, :day_id => i, :schedule_call_id => call.id, :group_id => group.id), :method => :post)
